<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This is the writeup for CSAPP Malloclab I am writing this blog after spending two days working on the malloclab. Finally came out with a piece of shit. I got 85&#x2F;100 in this lab, which almost “tot">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP malloclab">
<meta property="og:url" content="https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/index.html">
<meta property="og:site_name" content="Thomason&#39;s Blog">
<meta property="og:description" content="This is the writeup for CSAPP Malloclab I am writing this blog after spending two days working on the malloclab. Finally came out with a piece of shit. I got 85&#x2F;100 in this lab, which almost “tot">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-01-04T01:02:35.000Z">
<meta property="article:modified_time" content="2023-01-06T03:38:38.085Z">
<meta property="article:author" content="Thomason Zhao">
<meta property="article:tag" content="CSAPP Labs">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CSAPP malloclab</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <!-- fancybox support -->
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
  

<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/01/05/6-S081-Lab1-Xv6-and-Unix-utilities/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/12/26/CSAPP-shlab/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&text=CSAPP malloclab"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&is_video=false&description=CSAPP malloclab"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP malloclab&body=Check out this article: https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&name=CSAPP malloclab&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&t=CSAPP malloclab"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Goals"><span class="toc-number">1.</span> <span class="toc-text">Goals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementations"><span class="toc-number">2.</span> <span class="toc-text">Implementations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Implicit-Free-List"><span class="toc-number">2.1.</span> <span class="toc-text">Implicit Free List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#First-Fit-Search"><span class="toc-number">2.1.1.</span> <span class="toc-text">First Fit Search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Next-Fit-Search"><span class="toc-number">2.1.2.</span> <span class="toc-text">Next Fit Search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Best-Fit-Search"><span class="toc-number">2.1.3.</span> <span class="toc-text">Best Fit Search</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Segregate-Free-List"><span class="toc-number">2.2.</span> <span class="toc-text">Segregate Free List</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-Tips"><span class="toc-number">3.</span> <span class="toc-text">Debugging Tips</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">4.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CSAPP malloclab
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Thomason Zhao</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-01-04T01:02:35.000Z" itemprop="datePublished">2023-01-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Independent-Learning/">Independent Learning</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CSAPP-Labs/" rel="tag">CSAPP Labs</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>This is the writeup for CSAPP Malloclab</p>
<p>I am writing this blog after spending two days working on the malloclab. Finally came out with a piece of shit. I got 85&#x2F;100 in this lab, which almost “totally references” others’ implementations. I should do more work on C programming. I still have a long way to go. :(</p>
<h2 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h2><p>In this lab, we are going to write our own dynamic memory allocator, including the functionalities of what we usually use: <code>malloc</code>, <code>free</code>, and <code>realloc</code>. We will have to finish four functions in the provided lab handout: <code>mm_init</code>, <code>mm_malloc</code>, <code>mm_free</code>, and <code>mm_realloc</code>. Similar to the original malloc (ptmalloc), our dynamic allocator is an immediate general-purpose allocator, which (1) we may not make any assumption on the data structure we are going to store. (2) have to make allocation immediately after calling the allocation function. (3) data should align with the 8-byte alignment. </p>
<p>We will have a check program <code>mdriver.c</code>, after we do <code>make</code> in the handout directory, we are able to run the driver and test our code on different functionalities. (Caution: the trace file does not provide us with the handout, you may search on the web or use what I found in my <a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao/CMU-15-213-CSAPP">CSAPP github repo</a>)</p>
<p>Similar to the syscall that manages the virtual memory: <code>brk</code>, <code>sbrk</code>, and <code>mmap</code> (which we are not going to use), the handout provides us some syscall-like functions in <code>memlib.c</code>: <code>mem_sbrk</code>, <code>mem_heap_lo</code>, <code>mem_heap_hi</code>, <code>mem_heapsize</code>, and <code>mem_pagesize</code>.</p>
<h2 id="Implementations"><a href="#Implementations" class="headerlink" title="Implementations"></a>Implementations</h2><h3 id="Implicit-Free-List"><a href="#Implicit-Free-List" class="headerlink" title="Implicit Free List"></a>Implicit Free List</h3><p>Implicit free list implementation is actually provided by the code in the book. The data structure used in this implementation is as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">block</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">word_t</span> header;</span><br><span class="line">    <span class="type">void</span> *data;</span><br><span class="line">    <span class="type">word_t</span> footer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| header | data block &amp; padding | footer | another header | ... |</span><br></pre></td></tr></table></figure>

<blockquote>
<p>By the way, this project doesn’t allow us to define any explicitly stated structure like above, so we may first find out a good way to do the pointer arithmetic.</p>
</blockquote>
<p>We are suggested to use the macro to solve this issue. The reason not to use different helper functions to implement pointer arithmetic is that function calls are expensive. Each pointer arithmetic is really simple, but to make a function call needs to allocate a stack, jump to the function body, and jump back. This lab will be going to measure both the memory utilization of the implementation and the throughput. Macros, on the other hand, will do the pointer arithmetic in the compile time. The compiler will transform different macros to the corresponding assembly instructions and replace them everywhere in the binary ELF file. </p>
<p>The book provides us with the macro below. With those macros, we can easily manipulate the heap block data structure. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Basic constants and macros */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WSIZE 4             <span class="comment">/* Word and header/footer size (bytes) */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DSIZE 8             <span class="comment">/* Double word size (bytes) */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHUNKSIZE (1 &lt;&lt; 12) <span class="comment">/* Extend heap by this amount (bytes) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(x, y) ((x) &gt; (y) ? (x) : (y))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Pack a size and allocated bit into a word */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PACK(size, alloc) ((size) | (alloc))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Read and write a word at address p */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET(p) (*(unsigned int *)(p))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PUT(p, val) (*(unsigned int *)(p) = (val))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Read the size and allocated fields from address p */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_SIZE(p) (GET(p) &amp; ~0x7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_ALLOC(p) (GET(p) &amp; 0x1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Given block ptr bp, compute address of its header and footer */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HDRP(bp) ((char *)(bp) - WSIZE)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FTRP(bp) ((char *)(bp) + GET_SIZE(HDRP(bp)) - DSIZE)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Given block ptr bp, compute address of next and previous blocks */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NEXT_BLKP(bp) ((char *)(bp) + GET_SIZE(((char *)(bp) - WSIZE)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PREV_BLKP(bp) ((char *)(bp) - GET_SIZE(((char *)(bp) - DSIZE)))</span></span><br></pre></td></tr></table></figure>

<p>The implementation details will be discussed through the sequence of the calling routine. </p>
<p><code>mm_init</code> function is straightforward. First open part of the memory region for a default heap data structure: prologue and epilogue. These two data blocks are used to constrain the search will not go ahead of the heap start (prologue) and will not go beyond the heap end (epilogue). Then we extend a <code>CHUNKSIZE</code> of the heap to store values.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * mm_init - Initialize the malloc package.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mm_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> init_brk_size = <span class="number">4</span> * WSIZE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create the initial empty heap */</span></span><br><span class="line">    <span class="keyword">if</span> ((heap_listp = mem_sbrk(init_brk_size)) == (<span class="type">void</span> *)<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    PUT(heap_listp, <span class="number">0</span>);                            <span class="comment">/* Alignment padding */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">1</span> * WSIZE), PACK(DSIZE, <span class="number">1</span>)); <span class="comment">/* Prologue header */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">2</span> * WSIZE), PACK(DSIZE, <span class="number">1</span>)); <span class="comment">/* Prologue footer */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">3</span> * WSIZE), PACK(<span class="number">0</span>, <span class="number">1</span>));     <span class="comment">/* Epilogue header */</span></span><br><span class="line">    heap_listp += (<span class="number">2</span> * WSIZE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Extend the empty heap with a free block of CHUNKSIZE bytes */</span></span><br><span class="line">    <span class="keyword">if</span> (extend_heap(CHUNKSIZE / WSIZE) == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| padding | prologue header | prologue footer | heap start from here | ... | epilogue header |</span><br></pre></td></tr></table></figure>

<p><code>extend_heap</code> function mainly does two things: (1) use sbrk to open new space for heap. (2) make sure the newly opened space will be consistent with the original blocks, which we will use <code>coalesce</code> function for the newly inserted free block.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * extend_heap - Extend heap with free block and return its block pointer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> *<span class="title function_">extend_heap</span><span class="params">(<span class="type">size_t</span> words)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *bp;</span><br><span class="line">    <span class="type">size_t</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Allocate an even number of words to maintain alignment */</span></span><br><span class="line">    size = (words % <span class="number">2</span>) ? (words + <span class="number">1</span>) * WSIZE : words * WSIZE;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="type">long</span>)(bp = mem_sbrk(size)) == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialize free block header/footer and the epilogue header */</span></span><br><span class="line">    PUT(HDRP(bp), PACK(size, <span class="number">0</span>));         <span class="comment">/* Free block header */</span></span><br><span class="line">    PUT(FTRP(bp), PACK(size, <span class="number">0</span>));         <span class="comment">/* Free block footer */</span></span><br><span class="line">    PUT(HDRP(NEXT_BLKP(bp)), PACK(<span class="number">0</span>, <span class="number">1</span>)); <span class="comment">/* New epilogue header */</span></span><br><span class="line"></span><br><span class="line">    SET_PREV(bp, <span class="number">0</span>);</span><br><span class="line">    SET_NEXT(bp, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Coalesce if the previous block was free */</span></span><br><span class="line">    <span class="keyword">return</span> coalesce(bp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>coalesce</code> function will coalesce the previous and next free block to make a continuous big free block. Discuss the condition case by case based on the allocation bit that is stored in the header and footer of the previous and next blocks will be very easy to implement.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * coalesce - Boundary tag coalescing. Return ptr to coalesced block</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> *<span class="title function_">coalesce</span><span class="params">(<span class="type">void</span> *bp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> prev_alloc = GET_ALLOC(FTRP(PREV_BLKP(bp)));</span><br><span class="line">    <span class="type">size_t</span> next_alloc = GET_ALLOC(HDRP(NEXT_BLKP(bp)));</span><br><span class="line">    <span class="type">size_t</span> size = GET_SIZE(HDRP(bp));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prev_alloc &amp;&amp; next_alloc)</span><br><span class="line">    &#123; <span class="comment">/* Case 1 */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (prev_alloc &amp;&amp; !next_alloc)</span><br><span class="line">    &#123; <span class="comment">/* Case 2 */</span></span><br><span class="line">        size += GET_SIZE(HDRP(NEXT_BLKP(bp)));</span><br><span class="line">        PUT(HDRP(bp), PACK(size, <span class="number">0</span>));</span><br><span class="line">        PUT(FTRP(bp), PACK(size, <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!prev_alloc &amp;&amp; next_alloc)</span><br><span class="line">    &#123; <span class="comment">/* Case 3 */</span></span><br><span class="line">        size += GET_SIZE(HDRP(PREV_BLKP(bp)));</span><br><span class="line">        PUT(FTRP(bp), PACK(size, <span class="number">0</span>));</span><br><span class="line">        PUT(HDRP(PREV_BLKP(bp)), PACK(size, <span class="number">0</span>));</span><br><span class="line">        bp = PREV_BLKP(bp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123; <span class="comment">/* Case 4 */</span></span><br><span class="line">        size += GET_SIZE(HDRP(PREV_BLKP(bp))) +</span><br><span class="line">                GET_SIZE(FTRP(NEXT_BLKP(bp)));</span><br><span class="line">        PUT(HDRP(PREV_BLKP(bp)), PACK(size, <span class="number">0</span>));</span><br><span class="line">        PUT(FTRP(NEXT_BLKP(bp)), PACK(size, <span class="number">0</span>));</span><br><span class="line">        bp = PREV_BLKP(bp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mm_malloc</code> function will deal with first aligning the size (including header, footer, and data block size) provided by the user, trying to find a fit block of this size. There are two different search algorithms that will be discussed later: <a href="#first-fit-search">First Fit Search</a> and <a href="#best-fit-search">Best Fit Search</a>. If it fails, try to extend the heap by at least a <code>CHUNKSIZE</code> and return the new ptr as the allocated block. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * mm_malloc - Allocate a block with at least size bytes of payload</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mm_malloc</span><span class="params">(<span class="type">size_t</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> asize;      <span class="comment">/* Adjusted block size */</span></span><br><span class="line">    <span class="type">size_t</span> extendsize; <span class="comment">/* Amount to extend heap if no fit */</span></span><br><span class="line">    <span class="type">char</span> *bp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (heap_listp == <span class="number">0</span>)</span><br><span class="line">        mm_init();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Ignore spurious requests */</span></span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Adjust block size to include overhead and alignment reqs. */</span></span><br><span class="line">    asize = ALIGN(size + DSIZE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Search the free list for a fit */</span></span><br><span class="line">    <span class="keyword">if</span> ((bp = find_fit(asize)) != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        place(bp, asize);</span><br><span class="line">        <span class="keyword">return</span> bp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* No fit found. Get more memory and place the block */</span></span><br><span class="line">    extendsize = MAX(asize, CHUNKSIZE);</span><br><span class="line">    <span class="keyword">if</span> ((bp = extend_heap(extendsize / WSIZE)) == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    place(bp, asize);</span><br><span class="line">    <span class="keyword">return</span> bp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>place</code> function just to place the newly allocated block, mark it as allocated and do the split if the block is too large to fit. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * place - Place block of asize bytes at start of free block bp</span></span><br><span class="line"><span class="comment"> *         and split if remainder would be at least minimum block size</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">place</span><span class="params">(<span class="type">void</span> *bp, <span class="type">size_t</span> asize)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> csize = GET_SIZE(HDRP(bp));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((csize - asize) &gt;= (<span class="number">2</span> * DSIZE))</span><br><span class="line">    &#123; <span class="comment">/* Split large free block */</span></span><br><span class="line">        PUT(HDRP(bp), PACK(asize, <span class="number">1</span>));</span><br><span class="line">        PUT(FTRP(bp), PACK(asize, <span class="number">1</span>));</span><br><span class="line">        bp = NEXT_BLKP(bp);</span><br><span class="line">        PUT(HDRP(bp), PACK(csize - asize, <span class="number">0</span>));</span><br><span class="line">        PUT(FTRP(bp), PACK(csize - asize, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        SET_PREV(bp, <span class="number">0</span>);</span><br><span class="line">        SET_NEXT(bp, <span class="number">0</span>);</span><br><span class="line">        coalesce(bp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123; <span class="comment">/* Do not split */</span></span><br><span class="line">        PUT(HDRP(bp), PACK(csize, <span class="number">1</span>));</span><br><span class="line">        PUT(FTRP(bp), PACK(csize, <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mm_free</code> and <code>mm_realloc</code> will be easy to implement, so just place the code here.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * mm_free - Freeing a block does nothing.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mm_free</span><span class="params">(<span class="type">void</span> *ptr)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *bp = ptr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bp == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> size = GET_SIZE(HDRP(bp));</span><br><span class="line"></span><br><span class="line">    PUT(HDRP(bp), PACK(size, <span class="number">0</span>));</span><br><span class="line">    PUT(FTRP(bp), PACK(size, <span class="number">0</span>));</span><br><span class="line">    SET_PREV(bp, <span class="literal">NULL</span>);</span><br><span class="line">    SET_NEXT(bp, <span class="literal">NULL</span>);</span><br><span class="line">    coalesce(bp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * mm_realloc - Implemented simply in terms of mm_malloc and mm_free</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mm_realloc</span><span class="params">(<span class="type">void</span> *ptr, <span class="type">size_t</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> oldsize;</span><br><span class="line">    <span class="type">void</span> *newptr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If size == 0 then this is just free, and we return NULL. */</span></span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        mm_free(ptr);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If oldptr is NULL, then this is just malloc. */</span></span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> mm_malloc(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Copy the old data. */</span></span><br><span class="line">    oldsize = GET_SIZE(HDRP(ptr));</span><br><span class="line">    <span class="keyword">if</span> (ALIGN(size + DSIZE) &gt; oldsize)</span><br><span class="line">    &#123;</span><br><span class="line">        newptr = mm_malloc(size);</span><br><span class="line">        <span class="comment">/* If realloc() fails the original block is left untouched  */</span></span><br><span class="line">        <span class="keyword">if</span> (!newptr)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">memcpy</span>(newptr, ptr, oldsize - WSIZE);</span><br><span class="line">        oldsize = size;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Free the old block. */</span></span><br><span class="line">        mm_free(ptr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> newptr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="First-Fit-Search"><a href="#First-Fit-Search" class="headerlink" title="First Fit Search"></a>First Fit Search</h4><p>First fit search version of <code>find_fit</code> helper function:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * find_fit - Find a fit for a block with asize bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> *<span class="title function_">find_fit</span><span class="params">(<span class="type">size_t</span> asize)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* First-fit search */</span></span><br><span class="line">    <span class="type">void</span> *bp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (bp = heap_listp; GET_SIZE(HDRP(bp)) &gt; <span class="number">0</span>; bp = NEXT_BLKP(bp))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!GET_ALLOC(HDRP(bp)) &amp;&amp; (asize &lt;= GET_SIZE(HDRP(bp))))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> bp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">/* No fit */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Only implement the first fit search is not good enough, the utilization is fine, but throuput is too low.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Results for mm malloc:</span><br><span class="line">trace  valid  util     ops      secs  Kops</span><br><span class="line"> 0       yes   99%    5694  0.009120   624</span><br><span class="line"> 1       yes   99%    5848  0.008181   715</span><br><span class="line"> 2       yes   99%    6648  0.013710   485</span><br><span class="line"> 3       yes  100%    5380  0.010180   528</span><br><span class="line"> 4       yes   66%   14400  0.000756 19050</span><br><span class="line"> 5       yes   91%    4800  0.009039   531</span><br><span class="line"> 6       yes   92%    4800  0.007961   603</span><br><span class="line"> 7       yes   55%   12000  0.242923    49</span><br><span class="line"> 8       yes   51%   24000  0.386055    62</span><br><span class="line"> 9       yes   27%   14401  0.119937   120</span><br><span class="line">10       yes   34%   14401  0.004224  3409</span><br><span class="line">Total          74%  112372  0.812084   138</span><br><span class="line"></span><br><span class="line">Perf index = 44 (util) + 9 (thru) = 54/100</span><br></pre></td></tr></table></figure>

<h4 id="Next-Fit-Search"><a href="#Next-Fit-Search" class="headerlink" title="Next Fit Search"></a>Next Fit Search</h4><p>The next fit search version of <code>find_fit</code> helper function is shown below. We will need an additional global <code>rover</code> to store what is the last allocated block. We search from that block to the end, then search from the beginning until around back to <code>rover</code> block. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * find_fit - Find a fit for a block with asize bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> *<span class="title function_">find_fit</span><span class="params">(<span class="type">size_t</span> asize)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Next fit search */</span></span><br><span class="line">    <span class="type">char</span> *oldrover = rover;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Search from the rover to the end of list */</span></span><br><span class="line">    <span class="keyword">for</span> (; GET_SIZE(HDRP(rover)) &gt; <span class="number">0</span>; rover = NEXT_BLKP(rover))</span><br><span class="line">        <span class="keyword">if</span> (!GET_ALLOC(HDRP(rover)) &amp;&amp; (asize &lt;= GET_SIZE(HDRP(rover))))</span><br><span class="line">            <span class="keyword">return</span> rover;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* search from start of list to old rover */</span></span><br><span class="line">    <span class="keyword">for</span> (rover = heap_listp; rover &lt; oldrover; rover = NEXT_BLKP(rover))</span><br><span class="line">        <span class="keyword">if</span> (!GET_ALLOC(HDRP(rover)) &amp;&amp; (asize &lt;= GET_SIZE(HDRP(rover))))</span><br><span class="line">            <span class="keyword">return</span> rover;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">/* no fit found */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The result of the test shows that next fit is a lot better than the first fit search (probably because most of the test trace are written in malloc a lot of block at the beginning)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Results for mm malloc:</span><br><span class="line">trace  valid  util     ops      secs  Kops</span><br><span class="line"> 0       yes   91%    5694  0.002856  1994</span><br><span class="line"> 1       yes   92%    5848  0.001983  2949</span><br><span class="line"> 2       yes   95%    6648  0.005219  1274</span><br><span class="line"> 3       yes   97%    5380  0.005443   988</span><br><span class="line"> 4       yes   66%   14400  0.000714 20182</span><br><span class="line"> 5       yes   90%    4800  0.005957   806</span><br><span class="line"> 6       yes   89%    4800  0.006055   793</span><br><span class="line"> 7       yes   55%   12000  0.027610   435</span><br><span class="line"> 8       yes   51%   24000  0.014347  1673</span><br><span class="line"> 9       yes   27%   14401  0.118755   121</span><br><span class="line">10       yes   45%   14401  0.004188  3438</span><br><span class="line">Total          73%  112372  0.193127   582</span><br><span class="line"></span><br><span class="line">Perf index = 44 (util) + 39 (thru) = 82/100</span><br></pre></td></tr></table></figure>

<h4 id="Best-Fit-Search"><a href="#Best-Fit-Search" class="headerlink" title="Best Fit Search"></a>Best Fit Search</h4><p>I didn’t implement the best fit search, but I did implement it on my wisc easier version of malloc lab. So the logic is easy and can add on to both the first fit and next fit search. Have an additional variable to store the best size fit and the best fit block pointer. If we find another block fits better than the current one, we replace it with the new one. Once we find a perfect fit (same size), then we terminate the search and return that block.  </p>
<h3 id="Segregate-Free-List"><a href="#Segregate-Free-List" class="headerlink" title="Segregate Free List"></a>Segregate Free List</h3><p>Rather than using the implicit free list, we could make the free list visible to our program so that we can search through the free list instead of the. Though there are still many different implementations on the free list. I choose a relatively more sufficient implementation: segregate free list.</p>
<p>Segregate free list, by definition, is to put multiple free blocks within a range of size into a separate free list. We could have multiple ranges of sizes, here for malloclab, I choose the range cutoff: <code>16 32 64 128 256 512 1024 2048 4096</code>. Each free block will have a new data structure as follow:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">free_block</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">word_t</span> header;</span><br><span class="line">    <span class="type">void</span> *prev;</span><br><span class="line">    <span class="type">void</span> *next;</span><br><span class="line">    <span class="type">void</span> *leftover_data;</span><br><span class="line">    <span class="type">word_t</span> footer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since new data structure is introduced, we will need new macrod to deal with the free list.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Given free block ptr fbp, read and write prev and next ptr */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_PREV(fbp) (GET(fbp))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SET_PREV(fbp, prev) (PUT((fbp), (prev)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_NEXT(fbp) (GET((char *)(fbp) + WSIZE))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SET_NEXT(fbp, next) (PUT((char *)(fbp) + WSIZE, (next)))</span></span><br></pre></td></tr></table></figure>

<p>In order to store the free list, we will need additional space in the heap block to store it, so we will first make more room in the heap block to store the list.</p>
<p><code>sgrgt_list_init</code> function is used to initialize the segregate list before we initialize any prologue and epilogue block in the <code>mm_init</code> function. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sgrgt_list_init - Initialize the segregate list at the beginning of the heap.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sgrgt_list_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    sgrgt_listp = (<span class="type">unsigned</span> <span class="type">int</span> *)heap_listp;</span><br><span class="line">    PUT(heap_listp + (<span class="number">0</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 16 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">1</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 32 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">2</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 64 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">3</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 128 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">4</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 256 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">5</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 512 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">6</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 1024 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">7</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 2048 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">8</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &lt;= 4096 */</span></span><br><span class="line">    PUT(heap_listp + (<span class="number">9</span> * WSIZE), <span class="number">0</span>); <span class="comment">/* size &gt;  4096 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Shift the start of the heap */</span></span><br><span class="line">    heap_listp += <span class="number">10</span> * WSIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sgrgt_list_insrt</code> and <code>sgrgt_list_remov</code> functions are used to insert and remove a block to&#x2F;from the segregate list. The implementation is easy, just a double-linked list insert and remove.  A block should be inserted if it was coalesced in <code>coalesce</code> function and removed if it was to place as an allocated block in <code>place</code> function or coalesced in <code>coalesce</code> function to make a bigger free block.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * insrt_sgrgt_list - Insert a block to segregate list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sgrgt_list_insrt</span><span class="params">(<span class="type">void</span> *bp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (bp == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">void</span> *root = sgrgt_listp + sgrgt_list_idx(GET_SIZE(HDRP(bp)));</span><br><span class="line">    <span class="type">void</span> *curr = root;</span><br><span class="line">    <span class="type">void</span> *next = GET(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (GET_SIZE(HDRP(next)) &gt;= GET_SIZE(HDRP(bp)))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        curr = next;</span><br><span class="line">        next = GET_NEXT(next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (curr == root)</span><br><span class="line">    &#123; <span class="comment">/* Insert into root */</span></span><br><span class="line">        PUT(root, bp);</span><br><span class="line">        SET_PREV(bp, <span class="literal">NULL</span>);</span><br><span class="line">        SET_NEXT(bp, next);</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="literal">NULL</span>)</span><br><span class="line">            SET_PREV(next, bp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123; <span class="comment">/* Insert between curr and next */</span></span><br><span class="line">        SET_PREV(bp, curr);</span><br><span class="line">        SET_NEXT(bp, next);</span><br><span class="line">        SET_NEXT(curr, bp);</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="literal">NULL</span>)</span><br><span class="line">            SET_PREV(next, bp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * remov_sgrgt_list - Remove a block from segregate list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sgrgt_list_remov</span><span class="params">(<span class="type">void</span> *bp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (bp == <span class="literal">NULL</span> || GET_ALLOC(HDRP(bp)))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">void</span> *root = sgrgt_listp + sgrgt_list_idx(GET_SIZE(HDRP(bp)));</span><br><span class="line">    <span class="type">void</span> *prev = GET_PREV(bp);</span><br><span class="line">    <span class="type">void</span> *next = GET_NEXT(bp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Clear pointers */</span></span><br><span class="line">    SET_PREV(bp, <span class="literal">NULL</span>);</span><br><span class="line">    SET_NEXT(bp, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prev == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="literal">NULL</span>)</span><br><span class="line">            SET_PREV(next, <span class="literal">NULL</span>);</span><br><span class="line">        PUT(root, next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="literal">NULL</span>)</span><br><span class="line">            SET_PREV(next, prev);</span><br><span class="line">        SET_NEXT(prev, next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With all those helper functions above (and some small logic like setting the prev and next pointer when a free a block, remove the redundant pointer after alloc the block. Check out the <a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao/CMU-15-213-CSAPP">CSAPP github repo</a>), we could successfully implement the segregate list version of malloc. The improvement is huge compared to the first version.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Results for mm malloc:</span><br><span class="line">trace  valid  util     ops      secs  Kops</span><br><span class="line"> 0       yes   99%    5694  0.000922  6173</span><br><span class="line"> 1       yes   99%    5848  0.000932  6274</span><br><span class="line"> 2       yes   99%    6648  0.001061  6268</span><br><span class="line"> 3       yes  100%    5380  0.000919  5855</span><br><span class="line"> 4       yes   66%   14400  0.002008  7170</span><br><span class="line"> 5       yes   94%    4800  0.001548  3101</span><br><span class="line"> 6       yes   95%    4800  0.001583  3032</span><br><span class="line"> 7       yes   55%   12000  0.001968  6099</span><br><span class="line"> 8       yes   51%   24000  0.004786  5015</span><br><span class="line"> 9       yes   31%   14401  0.122253   118</span><br><span class="line">10       yes   30%   14401  0.005329  2702</span><br><span class="line">Total          75%  112372  0.143308   784</span><br><span class="line"></span><br><span class="line">Perf index = 45 (util) + 40 (thru) = 85/100</span><br></pre></td></tr></table></figure>

<h2 id="Debugging-Tips"><a href="#Debugging-Tips" class="headerlink" title="Debugging Tips"></a>Debugging Tips</h2><p>Modify the <code>Makefile</code> to compile the program with debugging symbols and also turns on the <code>gprof</code> profile check.</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Modified parts</span></span><br><span class="line"></span><br><span class="line">CFLAGS = -Wall -Og -m32 -pg -g</span><br><span class="line"><span class="comment"># -Og optimization will not interrupt the debugging</span></span><br><span class="line"><span class="comment"># -pg gprof profile check</span></span><br><span class="line"><span class="comment"># -g  compile with debugging symbol</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: mdriver</span></span><br><span class="line">	./mdriver -V</span><br><span class="line">	gprof ./mdriver &gt; gprof.out</span><br><span class="line">	cat gprof.out</span><br></pre></td></tr></table></figure>

<p><code>gprof</code> is a great tool to find out where we could do to improve the program. It will give a detailed call graph of the program and also some analysis on it. Here is what I have on the segregate free list version</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line">Flat profile:</span><br><span class="line"></span><br><span class="line">Each sample counts as 0.01 seconds.</span><br><span class="line">  %   cumulative   self              self     total           </span><br><span class="line"> time   seconds   seconds    calls  ms/call  ms/call  name    </span><br><span class="line"> 72.66      0.93     0.93       11    84.55   110.38  eval_mm_valid</span><br><span class="line"> 13.28      1.10     0.17    60985     0.00     0.00  add_range</span><br><span class="line">  8.59      1.21     0.11    60985     0.00     0.00  remove_range</span><br><span class="line">  1.56      1.23     0.02  1426824     0.00     0.00  sgrgt_list_insrt</span><br><span class="line">  0.78      1.24     0.01  3563688     0.00     0.00  sgrgt_list_idx</span><br><span class="line">  0.78      1.25     0.01   710172     0.00     0.00  find_fit</span><br><span class="line">  0.78      1.26     0.01   710172     0.00     0.00  mm_free</span><br><span class="line">  0.78      1.27     0.01      110     0.09     0.47  eval_mm_speed</span><br><span class="line">  0.78      1.28     0.01       11     0.91     1.29  eval_mm_util</span><br><span class="line">  0.00      1.28     0.00  1426824     0.00     0.00  coalesce</span><br><span class="line">  0.00      1.28     0.00  1426692     0.00     0.00  sgrgt_list_remov</span><br><span class="line">  0.00      1.28     0.00   710172     0.00     0.00  mm_malloc</span><br><span class="line">  0.00      1.28     0.00   710172     0.00     0.00  place</span><br><span class="line">  0.00      1.28     0.00   121970     0.00     0.00  mem_heap_hi</span><br><span class="line">  0.00      1.28     0.00   121970     0.00     0.00  mem_heap_lo</span><br><span class="line">  0.00      1.28     0.00   115176     0.00     0.00  mm_realloc</span><br><span class="line">  0.00      1.28     0.00    56388     0.00     0.00  mem_sbrk</span><br><span class="line">  0.00      1.28     0.00    56256     0.00     0.00  extend_heap</span><br><span class="line">  0.00      1.28     0.00      132     0.00     0.00  mem_reset_brk</span><br><span class="line">  0.00      1.28     0.00      132     0.00     0.00  mm_init</span><br><span class="line">  0.00      1.28     0.00      132     0.00     0.00  sgrgt_list_init</span><br><span class="line">  0.00      1.28     0.00       11     0.00     0.00  clear_ranges</span><br><span class="line">  0.00      1.28     0.00       11     0.00     0.00  free_trace</span><br><span class="line">  0.00      1.28     0.00       11     0.00     4.70  fsecs</span><br><span class="line">  0.00      1.28     0.00       11     0.00     4.70  ftimer_gettod</span><br><span class="line">  0.00      1.28     0.00       11     0.00     0.00  mem_heapsize</span><br><span class="line">  0.00      1.28     0.00       11     0.00     0.00  read_trace</span><br><span class="line">  0.00      1.28     0.00        1     0.00     0.00  init_fsecs</span><br><span class="line">  0.00      1.28     0.00        1     0.00     0.00  mem_init</span><br><span class="line">  0.00      1.28     0.00        1     0.00     0.00  printresults</span><br><span class="line"></span><br><span class="line"> %         the percentage of the total running time of the</span><br><span class="line">time       program used by this function.</span><br><span class="line"></span><br><span class="line">cumulative a running sum of the number of seconds accounted</span><br><span class="line"> seconds   for by this function and those listed above it.</span><br><span class="line"></span><br><span class="line"> self      the number of seconds accounted for by this</span><br><span class="line">seconds    function alone.  This is the major sort for this</span><br><span class="line">           listing.</span><br><span class="line"></span><br><span class="line">calls      the number of times this function was invoked, if</span><br><span class="line">           this function is profiled, else blank.</span><br><span class="line"></span><br><span class="line"> self      the average number of milliseconds spent in this</span><br><span class="line">ms/call    function per call, if this function is profiled,</span><br><span class="line">	   else blank.</span><br><span class="line"></span><br><span class="line"> total     the average number of milliseconds spent in this</span><br><span class="line">ms/call    function and its descendents per call, if this</span><br><span class="line">	   function is profiled, else blank.</span><br><span class="line"></span><br><span class="line">name       the name of the function.  This is the minor sort</span><br><span class="line">           for this listing. The index shows the location of</span><br><span class="line">	   the function in the gprof listing. If the index is</span><br><span class="line">	   in parenthesis it shows where it would appear in</span><br><span class="line">	   the gprof listing if it were to be printed.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2012-2020 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">Copying and distribution of this file, with or without modification,</span><br><span class="line">are permitted in any medium without royalty provided the copyright</span><br><span class="line">notice and this notice are preserved.</span><br><span class="line"></span><br><span class="line">		     Call graph (explanation follows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">granularity: each sample hit covers 4 byte(s) for 0.78% of 1.28 seconds</span><br><span class="line"></span><br><span class="line">index % time    self  children    called     name</span><br><span class="line">                                                 &lt;spontaneous&gt;</span><br><span class="line">[1]    100.0    0.00    1.28                 main [1]</span><br><span class="line">                0.93    0.28      11/11          eval_mm_valid [2]</span><br><span class="line">                0.00    0.05      11/11          fsecs [6]</span><br><span class="line">                0.01    0.00      11/11          eval_mm_util [12]</span><br><span class="line">                0.00    0.00      11/11          free_trace [26]</span><br><span class="line">                0.00    0.00      11/11          read_trace [28]</span><br><span class="line">                0.00    0.00       1/1           init_fsecs [29]</span><br><span class="line">                0.00    0.00       1/1           mem_init [30]</span><br><span class="line">                0.00    0.00       1/1           printresults [31]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.93    0.28      11/11          main [1]</span><br><span class="line">[2]     94.9    0.93    0.28      11         eval_mm_valid [2]</span><br><span class="line">                0.17    0.00   60985/60985       add_range [3]</span><br><span class="line">                0.11    0.00   60985/60985       remove_range [4]</span><br><span class="line">                0.00    0.00   51387/710172      mm_malloc [8]</span><br><span class="line">                0.00    0.00   51387/710172      mm_free [11]</span><br><span class="line">                0.00    0.00    9598/115176      mm_realloc [16]</span><br><span class="line">                0.00    0.00      11/132         mm_init [19]</span><br><span class="line">                0.00    0.00      11/132         mem_reset_brk [23]</span><br><span class="line">                0.00    0.00      11/11          clear_ranges [25]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.17    0.00   60985/60985       eval_mm_valid [2]</span><br><span class="line">[3]     13.3    0.17    0.00   60985         add_range [3]</span><br><span class="line">                0.00    0.00  121970/121970      mem_heap_lo [21]</span><br><span class="line">                0.00    0.00  121970/121970      mem_heap_hi [20]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.11    0.00   60985/60985       eval_mm_valid [2]</span><br><span class="line">[4]      8.6    0.11    0.00   60985         remove_range [4]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.01    0.04     110/110         ftimer_gettod [7]</span><br><span class="line">[5]      4.0    0.01    0.04     110         eval_mm_speed [5]</span><br><span class="line">                0.00    0.02  513870/710172      mm_malloc [8]</span><br><span class="line">                0.01    0.01  513870/710172      mm_free [11]</span><br><span class="line">                0.00    0.01   95980/115176      mm_realloc [16]</span><br><span class="line">                0.00    0.00     110/132         mm_init [19]</span><br><span class="line">                0.00    0.00     110/132         mem_reset_brk [23]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.05      11/11          main [1]</span><br><span class="line">[6]      4.0    0.00    0.05      11         fsecs [6]</span><br><span class="line">                0.00    0.05      11/11          ftimer_gettod [7]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.05      11/11          fsecs [6]</span><br><span class="line">[7]      4.0    0.00    0.05      11         ftimer_gettod [7]</span><br><span class="line">                0.01    0.04     110/110         eval_mm_speed [5]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00   51387/710172      eval_mm_util [12]</span><br><span class="line">                0.00    0.00   51387/710172      eval_mm_valid [2]</span><br><span class="line">                0.00    0.00   93528/710172      mm_realloc [16]</span><br><span class="line">                0.00    0.02  513870/710172      eval_mm_speed [5]</span><br><span class="line">[8]      2.1    0.00    0.03  710172         mm_malloc [8]</span><br><span class="line">                0.00    0.01  710172/710172      place [13]</span><br><span class="line">                0.01    0.00  710172/710172      find_fit [14]</span><br><span class="line">                0.00    0.00   56124/56256       extend_heap [18]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00   56256/1426824     extend_heap [18]</span><br><span class="line">                0.00    0.01  660396/1426824     place [13]</span><br><span class="line">                0.00    0.01  710172/1426824     mm_free [11]</span><br><span class="line">[9]      2.0    0.00    0.03 1426824         coalesce [9]</span><br><span class="line">                0.02    0.00 1426824/1426824     sgrgt_list_insrt [10]</span><br><span class="line">                0.00    0.00  716520/1426692     sgrgt_list_remov [17]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.02    0.00 1426824/1426824     coalesce [9]</span><br><span class="line">[10]     1.9    0.02    0.00 1426824         sgrgt_list_insrt [10]</span><br><span class="line">                0.00    0.00 1426824/3563688     sgrgt_list_idx [15]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00   51387/710172      eval_mm_util [12]</span><br><span class="line">                0.00    0.00   51387/710172      eval_mm_valid [2]</span><br><span class="line">                0.00    0.00   93528/710172      mm_realloc [16]</span><br><span class="line">                0.01    0.01  513870/710172      eval_mm_speed [5]</span><br><span class="line">[11]     1.8    0.01    0.01  710172         mm_free [11]</span><br><span class="line">                0.00    0.01  710172/1426824     coalesce [9]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.01    0.00      11/11          main [1]</span><br><span class="line">[12]     1.1    0.01    0.00      11         eval_mm_util [12]</span><br><span class="line">                0.00    0.00   51387/710172      mm_malloc [8]</span><br><span class="line">                0.00    0.00   51387/710172      mm_free [11]</span><br><span class="line">                0.00    0.00    9598/115176      mm_realloc [16]</span><br><span class="line">                0.00    0.00      11/132         mm_init [19]</span><br><span class="line">                0.00    0.00      11/132         mem_reset_brk [23]</span><br><span class="line">                0.00    0.00      11/11          mem_heapsize [27]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.01  710172/710172      mm_malloc [8]</span><br><span class="line">[13]     1.1    0.00    0.01  710172         place [13]</span><br><span class="line">                0.00    0.01  660396/1426824     coalesce [9]</span><br><span class="line">                0.00    0.00  710172/1426692     sgrgt_list_remov [17]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.01    0.00  710172/710172      mm_malloc [8]</span><br><span class="line">[14]     0.9    0.01    0.00  710172         find_fit [14]</span><br><span class="line">                0.00    0.00  710172/3563688     sgrgt_list_idx [15]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00  710172/3563688     find_fit [14]</span><br><span class="line">                0.00    0.00 1426692/3563688     sgrgt_list_remov [17]</span><br><span class="line">                0.00    0.00 1426824/3563688     sgrgt_list_insrt [10]</span><br><span class="line">[15]     0.8    0.01    0.00 3563688         sgrgt_list_idx [15]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00    9598/115176      eval_mm_util [12]</span><br><span class="line">                0.00    0.00    9598/115176      eval_mm_valid [2]</span><br><span class="line">                0.00    0.01   95980/115176      eval_mm_speed [5]</span><br><span class="line">[16]     0.5    0.00    0.01  115176         mm_realloc [16]</span><br><span class="line">                0.00    0.00   93528/710172      mm_malloc [8]</span><br><span class="line">                0.00    0.00   93528/710172      mm_free [11]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00  710172/1426692     place [13]</span><br><span class="line">                0.00    0.00  716520/1426692     coalesce [9]</span><br><span class="line">[17]     0.3    0.00    0.00 1426692         sgrgt_list_remov [17]</span><br><span class="line">                0.00    0.00 1426692/3563688     sgrgt_list_idx [15]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00     132/56256       mm_init [19]</span><br><span class="line">                0.00    0.00   56124/56256       mm_malloc [8]</span><br><span class="line">[18]     0.1    0.00    0.00   56256         extend_heap [18]</span><br><span class="line">                0.00    0.00   56256/1426824     coalesce [9]</span><br><span class="line">                0.00    0.00   56256/56388       mem_sbrk [22]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/132         eval_mm_util [12]</span><br><span class="line">                0.00    0.00      11/132         eval_mm_valid [2]</span><br><span class="line">                0.00    0.00     110/132         eval_mm_speed [5]</span><br><span class="line">[19]     0.0    0.00    0.00     132         mm_init [19]</span><br><span class="line">                0.00    0.00     132/56256       extend_heap [18]</span><br><span class="line">                0.00    0.00     132/56388       mem_sbrk [22]</span><br><span class="line">                0.00    0.00     132/132         sgrgt_list_init [24]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00  121970/121970      add_range [3]</span><br><span class="line">[20]     0.0    0.00    0.00  121970         mem_heap_hi [20]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00  121970/121970      add_range [3]</span><br><span class="line">[21]     0.0    0.00    0.00  121970         mem_heap_lo [21]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00     132/56388       mm_init [19]</span><br><span class="line">                0.00    0.00   56256/56388       extend_heap [18]</span><br><span class="line">[22]     0.0    0.00    0.00   56388         mem_sbrk [22]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/132         eval_mm_util [12]</span><br><span class="line">                0.00    0.00      11/132         eval_mm_valid [2]</span><br><span class="line">                0.00    0.00     110/132         eval_mm_speed [5]</span><br><span class="line">[23]     0.0    0.00    0.00     132         mem_reset_brk [23]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00     132/132         mm_init [19]</span><br><span class="line">[24]     0.0    0.00    0.00     132         sgrgt_list_init [24]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/11          eval_mm_valid [2]</span><br><span class="line">[25]     0.0    0.00    0.00      11         clear_ranges [25]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/11          main [1]</span><br><span class="line">[26]     0.0    0.00    0.00      11         free_trace [26]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/11          eval_mm_util [12]</span><br><span class="line">[27]     0.0    0.00    0.00      11         mem_heapsize [27]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00      11/11          main [1]</span><br><span class="line">[28]     0.0    0.00    0.00      11         read_trace [28]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00       1/1           main [1]</span><br><span class="line">[29]     0.0    0.00    0.00       1         init_fsecs [29]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00       1/1           main [1]</span><br><span class="line">[30]     0.0    0.00    0.00       1         mem_init [30]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                0.00    0.00       1/1           main [1]</span><br><span class="line">[31]     0.0    0.00    0.00       1         printresults [31]</span><br><span class="line">-----------------------------------------------</span><br><span class="line"></span><br><span class="line"> This table describes the call tree of the program, and was sorted by</span><br><span class="line"> the total amount of time spent in each function and its children.</span><br><span class="line"></span><br><span class="line"> Each entry in this table consists of several lines.  The line with the</span><br><span class="line"> index number at the left hand margin lists the current function.</span><br><span class="line"> The lines above it list the functions that called this function,</span><br><span class="line"> and the lines below it list the functions this one called.</span><br><span class="line"> This line lists:</span><br><span class="line">     index	A unique number given to each element of the table.</span><br><span class="line">		Index numbers are sorted numerically.</span><br><span class="line">		The index number is printed next to every function name so</span><br><span class="line">		it is easier to look up where the function is in the table.</span><br><span class="line"></span><br><span class="line">     % time	This is the percentage of the `total&#x27; time that was spent</span><br><span class="line">		in this function and its children.  Note that due to</span><br><span class="line">		different viewpoints, functions excluded by options, etc,</span><br><span class="line">		these numbers will NOT add up to 100%.</span><br><span class="line"></span><br><span class="line">     self	This is the total amount of time spent in this function.</span><br><span class="line"></span><br><span class="line">     children	This is the total amount of time propagated into this</span><br><span class="line">		function by its children.</span><br><span class="line"></span><br><span class="line">     called	This is the number of times the function was called.</span><br><span class="line">		If the function called itself recursively, the number</span><br><span class="line">		only includes non-recursive calls, and is followed by</span><br><span class="line">		a `+&#x27; and the number of recursive calls.</span><br><span class="line"></span><br><span class="line">     name	The name of the current function.  The index number is</span><br><span class="line">		printed after it.  If the function is a member of a</span><br><span class="line">		cycle, the cycle number is printed between the</span><br><span class="line">		function&#x27;s name and the index number.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> For the function&#x27;s parents, the fields have the following meanings:</span><br><span class="line"></span><br><span class="line">     self	This is the amount of time that was propagated directly</span><br><span class="line">		from the function into this parent.</span><br><span class="line"></span><br><span class="line">     children	This is the amount of time that was propagated from</span><br><span class="line">		the function&#x27;s children into this parent.</span><br><span class="line"></span><br><span class="line">     called	This is the number of times this parent called the</span><br><span class="line">		function `/&#x27; the total number of times the function</span><br><span class="line">		was called.  Recursive calls to the function are not</span><br><span class="line">		included in the number after the `/&#x27;.</span><br><span class="line"></span><br><span class="line">     name	This is the name of the parent.  The parent&#x27;s index</span><br><span class="line">		number is printed after it.  If the parent is a</span><br><span class="line">		member of a cycle, the cycle number is printed between</span><br><span class="line">		the name and the index number.</span><br><span class="line"></span><br><span class="line"> If the parents of the function cannot be determined, the word</span><br><span class="line"> `&lt;spontaneous&gt;&#x27; is printed in the `name&#x27; field, and all the other</span><br><span class="line"> fields are blank.</span><br><span class="line"></span><br><span class="line"> For the function&#x27;s children, the fields have the following meanings:</span><br><span class="line"></span><br><span class="line">     self	This is the amount of time that was propagated directly</span><br><span class="line">		from the child into the function.</span><br><span class="line"></span><br><span class="line">     children	This is the amount of time that was propagated from the</span><br><span class="line">		child&#x27;s children to the function.</span><br><span class="line"></span><br><span class="line">     called	This is the number of times the function called</span><br><span class="line">		this child `/&#x27; the total number of times the child</span><br><span class="line">		was called.  Recursive calls by the child are not</span><br><span class="line">		listed in the number after the `/&#x27;.</span><br><span class="line"></span><br><span class="line">     name	This is the name of the child.  The child&#x27;s index</span><br><span class="line">		number is printed after it.  If the child is a</span><br><span class="line">		member of a cycle, the cycle number is printed</span><br><span class="line">		between the name and the index number.</span><br><span class="line"></span><br><span class="line"> If there are any cycles (circles) in the call graph, there is an</span><br><span class="line"> entry for the cycle-as-a-whole.  This entry shows who called the</span><br><span class="line"> cycle (as parents) and the members of the cycle (as children.)</span><br><span class="line"> The `+&#x27; recursive calls entry shows the number of function calls that</span><br><span class="line"> were internal to the cycle, and the calls entry for each member shows,</span><br><span class="line"> for that member, how many times it was called from other members of</span><br><span class="line"> the cycle.</span><br><span class="line"></span><br><span class="line">Copyright (C) 2012-2020 Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">Copying and distribution of this file, with or without modification,</span><br><span class="line">are permitted in any medium without royalty provided the copyright</span><br><span class="line">notice and this notice are preserved.</span><br><span class="line"></span><br><span class="line">Index by function name</span><br><span class="line"></span><br><span class="line">   [3] add_range (mdriver.c)   [7] ftimer_gettod           [8] mm_malloc</span><br><span class="line">  [25] clear_ranges (mdriver.c) [29] init_fsecs           [16] mm_realloc</span><br><span class="line">   [9] coalesce (mm.c)        [20] mem_heap_hi            [13] place (mm.c)</span><br><span class="line">   [5] eval_mm_speed (mdriver.c) [21] mem_heap_lo         [31] printresults (mdriver.c)</span><br><span class="line">  [12] eval_mm_util (mdriver.c) [27] mem_heapsize         [28] read_trace (mdriver.c)</span><br><span class="line">   [2] eval_mm_valid (mdriver.c) [30] mem_init             [4] remove_range (mdriver.c)</span><br><span class="line">  [18] extend_heap (mm.c)     [23] mem_reset_brk          [15] sgrgt_list_idx (mm.c)</span><br><span class="line">  [14] find_fit (mm.c)        [22] mem_sbrk               [24] sgrgt_list_init (mm.c)</span><br><span class="line">  [26] free_trace (mdriver.c) [11] mm_free                [10] sgrgt_list_insrt (mm.c)</span><br><span class="line">   [6] fsecs                  [19] mm_init                [17] sgrgt_list_remov (mm.c)</span><br></pre></td></tr></table></figure>

<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Malloclab is inevitably the hardest lab among all labs in CSAPP. But I learned a lot from it (though my code is still a piece of shit). The next step will be to take look at what real libc ptmalloc is doing by studying its source code. Then we could head to the last lab - proxylab. </p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>Source code from the book</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/150100073">https://zhuanlan.zhihu.com/p/150100073</a></p>
<p><a target="_blank" rel="noopener" href="https://littlecsd.net/2019/02/14/csapp-Malloclab/">https://littlecsd.net/2019/02/14/csapp-Malloclab/</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Goals"><span class="toc-number">1.</span> <span class="toc-text">Goals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementations"><span class="toc-number">2.</span> <span class="toc-text">Implementations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Implicit-Free-List"><span class="toc-number">2.1.</span> <span class="toc-text">Implicit Free List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#First-Fit-Search"><span class="toc-number">2.1.1.</span> <span class="toc-text">First Fit Search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Next-Fit-Search"><span class="toc-number">2.1.2.</span> <span class="toc-text">Next Fit Search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Best-Fit-Search"><span class="toc-number">2.1.3.</span> <span class="toc-text">Best Fit Search</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Segregate-Free-List"><span class="toc-number">2.2.</span> <span class="toc-text">Segregate Free List</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-Tips"><span class="toc-number">3.</span> <span class="toc-text">Debugging Tips</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">4.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&text=CSAPP malloclab"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&is_video=false&description=CSAPP malloclab"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP malloclab&body=Check out this article: https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&title=CSAPP malloclab"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&name=CSAPP malloclab&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://thomasonzhao.github.io/2023/01/03/CSAPP-malloclab/&t=CSAPP malloclab"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    Thomason Zhao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


<!-- FancyBox -->

<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

</body>
</html>
