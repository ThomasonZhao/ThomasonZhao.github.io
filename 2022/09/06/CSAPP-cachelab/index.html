<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This is the write up for CSAPP cachelab Part AGeneral SolutionIn part A, we will need to write a cache simulator to interpret the trace output file generated by valgrind. At run time, the parameters f">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP cachelab">
<meta property="og:url" content="https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/index.html">
<meta property="og:site_name" content="Thomason&#39;s Blog">
<meta property="og:description" content="This is the write up for CSAPP cachelab Part AGeneral SolutionIn part A, we will need to write a cache simulator to interpret the trace output file generated by valgrind. At run time, the parameters f">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-09-07T03:10:18.000Z">
<meta property="article:modified_time" content="2023-03-13T21:45:45.915Z">
<meta property="article:author" content="Thomason Zhao">
<meta property="article:tag" content="CSAPP Labs">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CSAPP cachelab</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

  <!-- fancybox support -->
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
  

<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/12/26/CSAPP-shlab/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/08/27/MapleCTF-2022/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&text=CSAPP cachelab"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&is_video=false&description=CSAPP cachelab"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP cachelab&body=Check out this article: https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&name=CSAPP cachelab&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&t=CSAPP cachelab"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-A"><span class="toc-number">1.</span> <span class="toc-text">Part A</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#General-Solution"><span class="toc-number">1.1.</span> <span class="toc-text">General Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverse-Engineering"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse Engineering</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-B"><span class="toc-number">2.</span> <span class="toc-text">Part B</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#32-x-32"><span class="toc-number">2.1.</span> <span class="toc-text">32 x 32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#64-x-64"><span class="toc-number">2.2.</span> <span class="toc-text">64 x 64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#61-x-67"><span class="toc-number">2.3.</span> <span class="toc-text">61 x 67</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CSAPP cachelab
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Thomason Zhao</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-09-07T03:10:18.000Z" itemprop="datePublished">2022-09-06</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Independent-Learning/">Independent Learning</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CSAPP-Labs/" rel="tag">CSAPP Labs</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>This is the write up for CSAPP cachelab</p>
<h2 id="Part-A"><a href="#Part-A" class="headerlink" title="Part A"></a>Part A</h2><h3 id="General-Solution"><a href="#General-Solution" class="headerlink" title="General Solution"></a>General Solution</h3><p>In part A, we will need to write a cache simulator to interpret the trace output file generated by <code>valgrind</code>. At run time, the parameters for the cache will be given through command line options.</p>
<p>Luckily, the professor provides us with a reference binary as a template to “guide us through”, <em>or show the answer in front of us</em>.</p>
<p>The first thing first is to define a useful structure which can be used to simulate the cache. From the course video and the recitation, we are able to know that cache is composed of three parts: cache set, cache line, and cache block. Since it’s just a simulation, so we don’t need the cache block actually to store the data. We just need to determine if the address that the program access is a hit&#x2F;miss&#x2F;eviction. </p>
<p>Generally, a cache line needs a <code>valid bit</code>, <code>tag</code>, and <code>cache block</code>. But here we can remove <code>cache block</code> with the reason above and add a <code>lru</code> variable to act as a time stamp to determine which line should be evicted. </p>
<p>Cache line -&gt; cache set -&gt; cache. So here in the code blow, <code>Cache = ***cacheLine</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> valid_bit;</span><br><span class="line">    <span class="type">int</span> lru;</span><br><span class="line">    <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> tag;</span><br><span class="line">&#125; cacheLine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> cacheLine* cacheSet;</span><br><span class="line"><span class="keyword">typedef</span> cacheSet* Cache;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* initialize cache, allocate enough space for the cache */</span></span><br><span class="line">Cache <span class="title function_">init_cache</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> E, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> S = <span class="number">1</span> &lt;&lt; s;</span><br><span class="line">    Cache cache = (Cache)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(cacheSet) * S);</span><br><span class="line">    <span class="keyword">if</span> (cache == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cache[i] = (cacheSet)<span class="built_in">calloc</span>(E, <span class="keyword">sizeof</span>(cacheLine));</span><br><span class="line">        <span class="keyword">if</span> (cache[i] == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* free cache one by one */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">free_cache</span><span class="params">(Cache cache, <span class="type">int</span> s)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> S = <span class="number">1</span> &lt;&lt; s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">free</span>(cache[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(cache);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, another big thing is to understand how to use <code>getopt</code> by reading the man page and searching for demo code online. In <code>optstring</code>, an option followed by a colon <code>:</code> means it requires an argument, followed by two colons <code>:</code> means the argument is optional. If the <code>optstring</code> start with an add sign <code>+</code>, means it will stop when it meets the first unrecognizable option. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* filter out useful opts */</span></span><br><span class="line"><span class="keyword">while</span>((opt = getopt(argc, argv, <span class="string">&quot;+hvs:E:b:t:&quot;</span>)) != <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span>(opt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">            v_flag = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            s = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">            E = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">            b = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">            target = optarg;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">/* &#x27;?&#x27; */</span></span><br><span class="line">            print_help_msg();</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* check arguments */</span></span><br><span class="line"><span class="keyword">if</span> (s &lt;= <span class="number">0</span> || E &lt;=<span class="number">0</span> || b &lt;= <span class="number">0</span> || target == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s: Missing required command line argument\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    print_help_msg();</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, we have to analyze how the trace file accesses the cache and what should we do to determine if it is a hit&#x2F;miss&#x2F;eviction. </p>
<p>To index the cache, we should first know the cache set index from the provided <code>s, E, b, addr</code>. Second, we will check the <code>tag</code> in all valid cache lines to see if it matches. If it does match, we will get a hit, otherwise fail to hit (still need to determine whether it is a miss or eviction). </p>
<p>If the cache is not full, then it will be a miss, and the cache will put the data into the empty cache line. If it is full, then we will have to change the content of the last used cache line to the new input one, which is an eviction. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* access cache with the address to check whether is hit 1/miss 2/eviction 0 */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">access_cache</span><span class="params">(Cache cache, <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> addr, <span class="type">int</span> s, <span class="type">int</span> E, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> tag = addr &gt;&gt; (s + b);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> set_idx = (addr &gt;&gt; b) &amp; ((<span class="number">1</span> &lt;&lt; s) - <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> empty = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> evict = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    cacheSet cacheset = cache[set_idx];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; E; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (cacheset[i].valid_bit)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (cacheset[i].tag == tag)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// hit</span></span><br><span class="line">                cacheset[i].lru = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cacheset[i].lru++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cacheset[evict].lru &lt;= cacheset[i].lru)</span><br><span class="line">            &#123;</span><br><span class="line">                evict = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            empty = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (empty == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// eviction is as well as a miss</span></span><br><span class="line">        cacheset[evict].tag = tag;</span><br><span class="line">        cacheset[evict].lru = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// miss</span></span><br><span class="line">        cacheset[empty].valid_bit = <span class="number">1</span>;</span><br><span class="line">        cacheset[empty].tag = tag;</span><br><span class="line">        cacheset[empty].lru = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So now, the whole program basically accomplishes all goals we would like to achieve, combine them up and add some helper function like <code>print_help_msg</code> and scan through the trace file. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cachelab.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;getopt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> valid_bit;</span><br><span class="line">    <span class="type">int</span> lru;</span><br><span class="line">    <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> tag;</span><br><span class="line">&#125; cacheLine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> cacheLine* cacheSet;</span><br><span class="line"><span class="keyword">typedef</span> cacheSet* Cache;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_help_msg</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: ./csim [-hv] -s &lt;num&gt; -E &lt;num&gt; -b &lt;num&gt; -t &lt;file&gt; \n\</span></span><br><span class="line"><span class="string">Options:\n\</span></span><br><span class="line"><span class="string">  -h         Print this help message.\n\</span></span><br><span class="line"><span class="string">  -v         Optional verbose flag. \n\</span></span><br><span class="line"><span class="string">  -s &lt;num&gt;   Number of set index bits. \n\</span></span><br><span class="line"><span class="string">  -E &lt;num&gt;   Number of lines per set. \n\</span></span><br><span class="line"><span class="string">  -b &lt;num&gt;   Number of block offset bits. \n\</span></span><br><span class="line"><span class="string">  -t &lt;file&gt;  Trace file. \n\</span></span><br><span class="line"><span class="string">\n\</span></span><br><span class="line"><span class="string">Examples: \n\</span></span><br><span class="line"><span class="string">  linux&gt;  ./csim -s 4 -E 1 -b 4 -t traces/yi.trace \n\</span></span><br><span class="line"><span class="string">  linux&gt;  ./csim -v -s 8 -E 2 -b 4 -t traces/yi.trace \n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* initialize cache, allocate enough space for the cache */</span></span><br><span class="line">Cache <span class="title function_">init_cache</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> E, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> S = <span class="number">1</span> &lt;&lt; s;</span><br><span class="line">    Cache cache = (Cache)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(cacheSet) * S);</span><br><span class="line">    <span class="keyword">if</span> (cache == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cache[i] = (cacheSet)<span class="built_in">calloc</span>(E, <span class="keyword">sizeof</span>(cacheLine));</span><br><span class="line">        <span class="keyword">if</span> (cache[i] == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* free cache one by one */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">free_cache</span><span class="params">(Cache cache, <span class="type">int</span> s)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> S = <span class="number">1</span> &lt;&lt; s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">free</span>(cache[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(cache);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* access cache with the address to check whether is hit 1/miss 2/eviction 0 */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">access_cache</span><span class="params">(Cache cache, <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> addr, <span class="type">int</span> s, <span class="type">int</span> E, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> tag = addr &gt;&gt; (s + b);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> set_idx = (addr &gt;&gt; b) &amp; ((<span class="number">1</span> &lt;&lt; s) - <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> empty = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> evict = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    cacheSet cacheset = cache[set_idx];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; E; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (cacheset[i].valid_bit)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (cacheset[i].tag == tag)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// hit</span></span><br><span class="line">                cacheset[i].lru = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cacheset[i].lru++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cacheset[evict].lru &lt;= cacheset[i].lru)</span><br><span class="line">            &#123;</span><br><span class="line">                evict = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            empty = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (empty == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// eviction is as well as a miss</span></span><br><span class="line">        cacheset[evict].tag = tag;</span><br><span class="line">        cacheset[evict].lru = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// miss</span></span><br><span class="line">        cacheset[empty].valid_bit = <span class="number">1</span>;</span><br><span class="line">        cacheset[empty].tag = tag;</span><br><span class="line">        cacheset[empty].lru = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> opt;</span><br><span class="line">    <span class="type">int</span> v_flag = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> E = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* filter out useful opts */</span></span><br><span class="line">    <span class="keyword">while</span>((opt = getopt(argc, argv, <span class="string">&quot;+hvs:E:b:t:&quot;</span>)) != <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span>(opt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">                v_flag = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                s = atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">                E = atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">                b = atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">                target = optarg;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">            <span class="keyword">default</span>: <span class="comment">/* &#x27;?&#x27; */</span></span><br><span class="line">                print_help_msg();</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* check arguments */</span></span><br><span class="line">    <span class="keyword">if</span> (s &lt;= <span class="number">0</span> || E &lt;=<span class="number">0</span> || b &lt;= <span class="number">0</span> || target == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s: Missing required command line argument\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        print_help_msg();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* initilize cache */</span></span><br><span class="line">    Cache cache = init_cache(s, E, b);</span><br><span class="line">    <span class="keyword">if</span> ( cache == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fail to initilize caches!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FILE *target_file;</span><br><span class="line">    target_file = fopen(target, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (target_file == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fail to open the trace file!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* scan through file*/</span></span><br><span class="line">    <span class="type">char</span> operation;</span><br><span class="line">    <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span> addr;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hit_count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> miss_count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> eviction_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> condition;</span><br><span class="line">    <span class="type">char</span>* template[] = &#123;<span class="string">&quot;eviction&quot;</span>, <span class="string">&quot;hit&quot;</span>, <span class="string">&quot;miss&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">fscanf</span>(target_file, <span class="string">&quot; %c %lx, %d\n&quot;</span>, &amp;operation, &amp;addr, &amp;size) != <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span>(operation)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">                condition = access_cache(cache, addr, s, E, b);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                condition = access_cache(cache, addr, s, E, b);</span><br><span class="line">                hit_count++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Wrong operation in trace file!&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(condition)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// eviction is also miss</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                eviction_count++;</span><br><span class="line">                miss_count++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// hit</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                hit_count++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// miss</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                miss_count++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (v_flag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span>(operation)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %lx, %d %s\n&quot;</span>, operation, addr, size, template[condition]);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %lx, %d %s hit\n&quot;</span>, operation, addr, size, template[condition]);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printSummary(hit_count, miss_count, eviction_count);</span><br><span class="line">    free_cache(cache, s);</span><br><span class="line">    fclose(target_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Part A: Testing cache simulator</span><br><span class="line">Running ./test-csim</span><br><span class="line">                        Your simulator     Reference simulator</span><br><span class="line">Points (s,E,b)    Hits  Misses  Evicts    Hits  Misses  Evicts</span><br><span class="line">     3 (1,1,1)       9       8       6       9       8       6  traces/yi2.trace</span><br><span class="line">     3 (4,2,4)       4       5       2       4       5       2  traces/yi.trace</span><br><span class="line">     3 (2,1,4)       2       3       1       2       3       1  traces/dave.trace</span><br><span class="line">     3 (2,1,3)     167      71      67     167      71      67  traces/trans.trace</span><br><span class="line">     3 (2,2,3)     201      37      29     201      37      29  traces/trans.trace</span><br><span class="line">     3 (2,4,3)     212      26      10     212      26      10  traces/trans.trace</span><br><span class="line">     3 (5,1,5)     231       7       0     231       7       0  traces/trans.trace</span><br><span class="line">     6 (5,1,5)  265189   21775   21743  265189   21775   21743  traces/long.trace</span><br><span class="line">    27</span><br></pre></td></tr></table></figure>

<h3 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h3><p>This is a trickier version of solve. Since the professor provides the reference file, we can reverse engineer it to get the content and logic in the <code>csim-ref</code> binary file. Luckily, it compiles with all symbols preserved, it looks exactly the same as the source code in some professional reverse engineering tools. Here is just an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> c; <span class="comment">// [rsp+2Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    c = getopt(argc, (<span class="type">char</span> *<span class="type">const</span> *)argv, <span class="string">&quot;s:E:b:t:vh&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( c == <span class="number">-1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">switch</span> ( c )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">        E = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        b = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">        printUsage((<span class="type">char</span> **)argv);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        s = atoi(optarg);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">        trace_file = optarg;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">        verbosity = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        printUsage((<span class="type">char</span> **)argv);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !s || !E || !b || !trace_file )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s: Missing required command line argument\n&quot;</span>, *argv);</span><br><span class="line">    printUsage((<span class="type">char</span> **)argv);</span><br><span class="line">  &#125;</span><br><span class="line">  S = (<span class="type">int</span>)<span class="built_in">pow</span>(<span class="number">2.0</span>, (<span class="type">double</span>)s);</span><br><span class="line">  B = (<span class="type">int</span>)<span class="built_in">pow</span>(<span class="number">2.0</span>, (<span class="type">double</span>)b);</span><br><span class="line">  initCache();</span><br><span class="line">  replayTrace(trace_file);</span><br><span class="line">  freeCache();</span><br><span class="line">  printSummary(hit_count, miss_count, eviction_count);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Through reverse the logic, we can also know what we need to do in our program XD. </p>
<h2 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h2><p>In part B, we are going to write a function to transpose matrix with different sizes 32 x 32, 64 x 64, 61 x 67, under the cache condition of <code>s = 5, E = 1, b = 5</code>, which has 32 set&#x2F;line, each line have 32 bytes.</p>
<h3 id="32-x-32"><a href="#32-x-32" class="headerlink" title="32 x 32"></a>32 x 32</h3><p>A 32 x 32 matrix is easy. Since each line of cache can store at most 8 <code>int</code>. Splitting the block into 8 x 8 submatrix, reading out each line in matrix A and copying it to each column in matrix B will solve the problem. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (M == <span class="number">32</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="type">int</span> t0, t1, t2, t3, t4, t5, t6, t7;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i += <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j += <span class="number">8</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = i; k &lt; i + <span class="number">8</span>; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                t0 = A[k][j];</span><br><span class="line">                t1 = A[k][j + <span class="number">1</span>];</span><br><span class="line">                t2 = A[k][j + <span class="number">2</span>];</span><br><span class="line">                t3 = A[k][j + <span class="number">3</span>];</span><br><span class="line">                t4 = A[k][j + <span class="number">4</span>];</span><br><span class="line">                t5 = A[k][j + <span class="number">5</span>];</span><br><span class="line">                t6 = A[k][j + <span class="number">6</span>];</span><br><span class="line">                t7 = A[k][j + <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">                B[j][k] = t0;</span><br><span class="line">                B[j + <span class="number">1</span>][k] = t1;</span><br><span class="line">                B[j + <span class="number">2</span>][k] = t2;</span><br><span class="line">                B[j + <span class="number">3</span>][k] = t3;</span><br><span class="line">                B[j + <span class="number">4</span>][k] = t4;</span><br><span class="line">                B[j + <span class="number">5</span>][k] = t5;</span><br><span class="line">                B[j + <span class="number">6</span>][k] = t6;</span><br><span class="line">                B[j + <span class="number">7</span>][k] = t7;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Function 0 (2 total)</span><br><span class="line">Step 1: Validating and generating memory traces</span><br><span class="line">Step 2: Evaluating performance (s=5, E=1, b=5)</span><br><span class="line">func 0 (Transpose submission): hits:1766, misses:287, evictions:255</span><br><span class="line"></span><br><span class="line">Function 1 (2 total)</span><br><span class="line">Step 1: Validating and generating memory traces</span><br><span class="line">Step 2: Evaluating performance (s=5, E=1, b=5)</span><br><span class="line">func 1 (Simple row-wise scan transpose): hits:870, misses:1183, evictions:1151</span><br><span class="line"></span><br><span class="line">Summary for official submission (func 0): correctness=1 misses=287</span><br><span class="line"></span><br><span class="line">TEST_TRANS_RESULTS=1:287</span><br></pre></td></tr></table></figure>

<h3 id="64-x-64"><a href="#64-x-64" class="headerlink" title="64 x 64"></a>64 x 64</h3><p>This is the hardest part of the assignment, I didn’t finish this myself, so I take reference from <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/42754565">here</a>. </p>
<p>So basically, the idea is to split the 8 x 8  matrix into a smaller 4 x 4 matrix. However, if we directly apply the idea to the 8 x 8 matrix, the result will be the same as splitting the original matrix into a 4 x 4 matrix, which is about 1644 misses, failing the test.</p>
<p>That’s because these two methods have the same idea, which is to read 4 rows in A and write 4 columns in B. So they have the same result, no matter what size the original matrix is.   </p>
<p>The trick is that: When reading the first four lines of the 8 x 8 submatrix, it also reads in the content in block <code>2</code> and stores it somewhere in matrix B (the content in B doesn’t matter because not finished yet). We use the same cache to read out more data. </p>
<p>Then, we reuse the cache to recover the lost block <code>2</code> in matrix B and copy the rest content to B.   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1   2</span><br><span class="line"></span><br><span class="line">3   4</span><br></pre></td></tr></table></figure>

<p>So in the code, it reverses the read sequence to “preheat” the cache and prepare for the following read&#x2F;write in blocks <code>3</code> and <code>4</code> to decrease the miss further.  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (M == <span class="number">64</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i, j, k, l;</span><br><span class="line">    <span class="type">int</span> t0, t1, t2, t3, t4, t5, t6, t7;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i += <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j += <span class="number">8</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = i; k &lt; i + <span class="number">4</span>; ++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/* read upper left, upper right*/</span></span><br><span class="line">                t0 = A[k][j];</span><br><span class="line">                t1 = A[k][j+<span class="number">1</span>];</span><br><span class="line">                t2 = A[k][j+<span class="number">2</span>];</span><br><span class="line">                t3 = A[k][j+<span class="number">3</span>];</span><br><span class="line">                t4 = A[k][j+<span class="number">4</span>];</span><br><span class="line">                t5 = A[k][j+<span class="number">5</span>];</span><br><span class="line">                t6 = A[k][j+<span class="number">6</span>];</span><br><span class="line">                t7 = A[k][j+<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">                B[j][k] = t0;</span><br><span class="line">                B[j+<span class="number">1</span>][k] = t1;</span><br><span class="line">                B[j+<span class="number">2</span>][k] = t2;</span><br><span class="line">                B[j+<span class="number">3</span>][k] = t3;</span><br><span class="line">                <span class="comment">/* reverse the sequence */</span></span><br><span class="line">                B[j][k+<span class="number">4</span>] = t7;</span><br><span class="line">                B[j+<span class="number">1</span>][k+<span class="number">4</span>] = t6;</span><br><span class="line">                B[j+<span class="number">2</span>][k+<span class="number">4</span>] = t5;</span><br><span class="line">                B[j+<span class="number">3</span>][k+<span class="number">4</span>] = t4;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (l = <span class="number">0</span>; l &lt; <span class="number">4</span>; ++l)</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="comment">/* read by column */</span></span><br><span class="line">                t0 = A[i+<span class="number">4</span>][j+<span class="number">3</span>-l];</span><br><span class="line">                t1 = A[i+<span class="number">5</span>][j+<span class="number">3</span>-l];</span><br><span class="line">                t2 = A[i+<span class="number">6</span>][j+<span class="number">3</span>-l];</span><br><span class="line">                t3 = A[i+<span class="number">7</span>][j+<span class="number">3</span>-l];</span><br><span class="line">                t4 = A[i+<span class="number">4</span>][j+<span class="number">4</span>+l];</span><br><span class="line">                t5 = A[i+<span class="number">5</span>][j+<span class="number">4</span>+l];</span><br><span class="line">                t6 = A[i+<span class="number">6</span>][j+<span class="number">4</span>+l];</span><br><span class="line">                t7 = A[i+<span class="number">7</span>][j+<span class="number">4</span>+l];</span><br><span class="line"></span><br><span class="line">               <span class="comment">/* transfer upper right to lower left */</span></span><br><span class="line">                B[j+<span class="number">4</span>+l][i] = B[j+<span class="number">3</span>-l][i+<span class="number">4</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">1</span>] = B[j+<span class="number">3</span>-l][i+<span class="number">5</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">2</span>] = B[j+<span class="number">3</span>-l][i+<span class="number">6</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">3</span>] = B[j+<span class="number">3</span>-l][i+<span class="number">7</span>];</span><br><span class="line">               <span class="comment">/* place the lower blocks to right */</span></span><br><span class="line">                B[j+<span class="number">3</span>-l][i+<span class="number">4</span>] = t0;</span><br><span class="line">                B[j+<span class="number">3</span>-l][i+<span class="number">5</span>] = t1;</span><br><span class="line">                B[j+<span class="number">3</span>-l][i+<span class="number">6</span>] = t2;</span><br><span class="line">                B[j+<span class="number">3</span>-l][i+<span class="number">7</span>] = t3;</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">4</span>] = t4;</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">5</span>] = t5;</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">6</span>] = t6;</span><br><span class="line">                B[j+<span class="number">4</span>+l][i+<span class="number">7</span>] = t7;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Function 1 (2 total)</span><br><span class="line">Step 1: Validating and generating memory traces</span><br><span class="line">Step 2: Evaluating performance (s=5, E=1, b=5)</span><br><span class="line">func 1 (Simple row-wise scan transpose): hits:3474, misses:4723, evictions:4691</span><br><span class="line"></span><br><span class="line">Summary for official submission (func 0): correctness=1 misses=1243</span><br><span class="line"></span><br><span class="line">TEST_TRANS_RESULTS=1:1243</span><br></pre></td></tr></table></figure>

<h3 id="61-x-67"><a href="#61-x-67" class="headerlink" title="61 x 67"></a>61 x 67</h3><p>This is also very simple to deal with. Since it is not a square matrix, the improvement to split the matrix into smaller parts is little. We can just split it into a 16 x 16 matrix and it will be fine. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (M == <span class="number">61</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i, j, k, l;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i += <span class="number">16</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j += <span class="number">16</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = i; k &lt; i + <span class="number">16</span> &amp;&amp; k &lt; N; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (l = j; l &lt; j + <span class="number">16</span> &amp;&amp; l &lt; M; l++)</span><br><span class="line">                &#123;</span><br><span class="line">                    B[l][k] = A[k][l];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Function 0 (2 total)</span><br><span class="line">Step 1: Validating and generating memory traces</span><br><span class="line">Step 2: Evaluating performance (s=5, E=1, b=5)</span><br><span class="line">func 0 (Transpose submission): hits:6187, misses:1992, evictions:1960</span><br><span class="line"></span><br><span class="line">Function 1 (2 total)</span><br><span class="line">Step 1: Validating and generating memory traces</span><br><span class="line">Step 2: Evaluating performance (s=5, E=1, b=5)</span><br><span class="line">func 1 (Simple row-wise scan transpose): hits:3756, misses:4423, evictions:4391</span><br><span class="line"></span><br><span class="line">Summary for official submission (func 0): correctness=1 misses=1992</span><br><span class="line"></span><br><span class="line">TEST_TRANS_RESULTS=1:1992</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-A"><span class="toc-number">1.</span> <span class="toc-text">Part A</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#General-Solution"><span class="toc-number">1.1.</span> <span class="toc-text">General Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverse-Engineering"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse Engineering</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-B"><span class="toc-number">2.</span> <span class="toc-text">Part B</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#32-x-32"><span class="toc-number">2.1.</span> <span class="toc-text">32 x 32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#64-x-64"><span class="toc-number">2.2.</span> <span class="toc-text">64 x 64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#61-x-67"><span class="toc-number">2.3.</span> <span class="toc-text">61 x 67</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&text=CSAPP cachelab"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&is_video=false&description=CSAPP cachelab"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP cachelab&body=Check out this article: https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&title=CSAPP cachelab"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&name=CSAPP cachelab&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://thomasonzhao.github.io/2022/09/06/CSAPP-cachelab/&t=CSAPP cachelab"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    Thomason Zhao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ThomasonZhao">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


<!-- FancyBox -->

<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

</body>
</html>
